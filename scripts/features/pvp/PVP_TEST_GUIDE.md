# PVP系统测试指南

## 测试环境准备

1. 确保服务器已启动并运行
2. 至少需要2个玩家账号进行测试
3. 其中1个账号需要管理员权限（使用 `/tag @s add admin`）

## 测试清单

### 1. 基础功能测试

#### 1.1 管理员配置测试
- [ ] 打开服务器菜单 → 服务器设置 → PVP管理
- [ ] 测试启用/禁用PVP功能
- [ ] 测试调整夺取金额（建议：50-200）
- [ ] 测试调整最低金币保护（建议：100）
- [ ] 测试调整切换冷却时间（建议：30秒）
- [ ] 测试调整战斗标签时间（建议：10秒）

#### 1.2 玩家PVP开关测试
- [ ] 打开服务器菜单 → PVP系统
- [ ] 验证显示当前PVP状态
- [ ] 测试开启PVP
- [ ] 测试关闭PVP
- [ ] 验证冷却时间是否生效
- [ ] 验证战斗中无法切换PVP

### 2. PVP战斗测试

#### 2.1 基础PVP测试
- [ ] 玩家A和玩家B都开启PVP
- [ ] 玩家A攻击玩家B，验证可以造成伤害
- [ ] 玩家A关闭PVP
- [ ] 玩家B攻击玩家A，验证攻击被取消
- [ ] 验证提示消息"该玩家未开启PVP或PVP功能未启用"

#### 2.2 管理员权限测试
- [ ] 管理员账号攻击任何玩家（无论对方是否开启PVP）
- [ ] 验证管理员可以攻击所有人

#### 2.3 领地保护测试
- [ ] 在领地内，即使双方都开启PVP
- [ ] 验证领地内无法进行PVP
- [ ] 在领地外，双方开启PVP
- [ ] 验证可以正常PVP

### 3. 战斗标签测试

- [ ] 玩家A和玩家B都开启PVP
- [ ] 玩家A攻击玩家B
- [ ] 立即尝试关闭PVP
- [ ] 验证提示"战斗中无法切换PVP状态"
- [ ] 等待10秒后（战斗标签过期）
- [ ] 验证可以成功切换PVP状态

### 4. 击杀与夺取测试

#### 4.1 击杀特效测试
- [ ] 玩家A击杀玩家B
- [ ] 验证出现闪电粒子效果
- [ ] 验证播放雷鸣音效
- [ ] 验证周围50格内的玩家也能看到/听到特效

#### 4.2 金币夺取测试
- [ ] 查看玩家B当前金币数量
- [ ] 玩家A击杀玩家B
- [ ] 验证玩家A获得固定金额的金币
- [ ] 验证玩家B失去相应金币
- [ ] 验证击杀者收到通知："夺取金币：X 连杀数：X"
- [ ] 验证被击杀者收到通知："被夺取：X 剩余金币：X"

#### 4.3 保护机制测试
- [ ] 设置玩家金币为接近最低保护值
- [ ] 进行击杀
- [ ] 验证被击杀者金币不会低于保护值

### 5. 连杀系统测试

#### 5.1 连杀统计测试
- [ ] 玩家A连续击杀玩家B多次
- [ ] 打开PVP系统查看统计
- [ ] 验证连杀数正确递增
- [ ] 验证最佳连杀数更新
- [ ] 玩家A被击杀
- [ ] 验证连杀数重置为0

#### 5.2 连杀广播测试
- [ ] 玩家A达到3连杀
- [ ] 验证双方收到广播消息
- [ ] 验证5连杀、10连杀等也有广播

### 6. 统计系统测试

#### 6.1 个人统计测试
- [ ] 打开PVP系统 → 查看详细统计
- [ ] 验证击杀数、死亡数正确
- [ ] 验证K/D比计算正确
- [ ] 验证总夺取金币统计正确
- [ ] 验证总被夺取金币统计正确
- [ ] 验证净收益计算正确

#### 6.2 排行榜测试
- [ ] 打开PVP系统 → 排行榜
- [ ] 测试击杀排行榜
  - [ ] 验证按击杀数降序排列
  - [ ] 验证前3名有奖牌标识
- [ ] 测试最佳连杀排行榜
  - [ ] 验证按最佳连杀数降序排列
- [ ] 测试夺取金币排行榜
  - [ ] 验证按总夺取金币降序排列
- [ ] 验证玩家自己的排名正确显示

### 7. 全局开关测试

#### 7.1 禁用PVP功能
- [ ] 管理员打开PVP管理
- [ ] 禁用PVP功能
- [ ] 验证服务器菜单中PVP系统按钮消失
- [ ] 验证玩家无法攻击其他玩家

#### 7.2 启用PVP功能
- [ ] 管理员打开PVP管理
- [ ] 启用PVP功能
- [ ] 验证服务器菜单中PVP系统按钮显示
- [ ] 验证玩家可以正常使用PVP功能

## 性能测试

### 战斗超时检查
- [ ] 多个玩家同时进入战斗状态
- [ ] 验证战斗超时检查不会导致服务器卡顿
- [ ] 验证所有玩家的战斗标签都能正常过期

### 数据持久化
- [ ] 进行一些PVP战斗
- [ ] 重启服务器
- [ ] 验证统计数据保留
- [ ] 验证配置保留

## 边界情况测试

### 极端数值测试
- [ ] 设置夺取金额为0，验证不夺取金币
- [ ] 设置夺取金额为1000，验证正常夺取
- [ ] 设置最低保护为0，验证可以夺取所有金币
- [ ] 设置冷却时间为0，验证可以立即切换

### 异常情况测试
- [ ] 玩家在战斗中退出游戏，验证战斗状态会超时清除
- [ ] 玩家金币不足保护值，验证不会夺取金币
- [ ] 同时多人击杀同一玩家，验证数据一致性

## 测试完成标准

- [ ] 所有基础功能正常工作
- [ ] 所有保护机制正常工作
- [ ] 没有发现严重bug
- [ ] 性能表现良好
- [ ] 用户体验流畅

## 已知限制

1. PVP系统优先于领地保护，领地内禁止PVP
2. 管理员可以无视任何PVP设置攻击玩家
3. 战斗标签只在受到攻击时触发，不包括其他伤害源
4. 排行榜最多显示前10名

## 注意事项

- 测试前建议备份服务器数据
- 测试时注意观察控制台是否有错误输出
- 建议在测试服务器而非正式服务器进行完整测试

